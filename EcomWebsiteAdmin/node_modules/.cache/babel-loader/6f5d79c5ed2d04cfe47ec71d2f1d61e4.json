{"ast":null,"code":"var _jsxFileName = \"D:\\\\job\\\\ComputerShopNode-Plus\\\\ComputerShopAdmin\\\\src\\\\views\\\\auth-views\\\\components\\\\LoginForm.js\";\nimport React, { useState } from \"react\";\nimport { Button, Form, Input, message as AntdMessage } from \"antd\";\nimport { UserOutlined, LockOutlined } from \"@ant-design/icons\";\nimport { useHistory } from \"react-router-dom\";\nimport { login as loginApi } from \"services/authService\"; // Import API login từ authService\nimport { jwtDecode } from \"jwt-decode\"; // Import jwt-decode\n\nconst LoginForm = () => {\n  let history = useHistory();\n\n  // State management\n  const [loading, setLoading] = useState(false); // Quản lý trạng thái loading\n  const [showForgetPassword, setShowForgetPassword] = useState(false); // Quản lý trạng thái hiển thị quên mật khẩu\n\n  const onLogin = async values => {\n    setLoading(true); // Hiển thị trạng thái loading\n\n    try {\n      // Gọi API đăng nhập từ authService với username và password\n      const response = await loginApi(values.username, values.password);\n\n      // Kiểm tra nếu đăng nhập thành công\n      if (response && response.payload) {\n        const {\n          jwtToken\n        } = response.payload[0]; // Lấy jwtToken từ payload\n        const user = response.payload[1]; // Thông tin người dùng\n\n        // Giải mã JWT để lấy thời gian hết hạn\n        const decodedToken = jwtDecode(jwtToken);\n        const expirationTime = decodedToken.exp * 1000; // Thời gian hết hạn trong milliseconds\n        if (user.role === \"CUSTOMER\") {\n          AntdMessage.warning(\"Bạn không có quyền truy cập\");\n          return;\n        } else if (user.isDelete) {\n          AntdMessage.warning(\"Tài khoản của bạn đã bị khóa \");\n          return;\n        } else if (!user.active) {\n          AntdMessage.warning(\"Tài khoản của bạn chưa được kích hoạt \");\n          return;\n        }\n        // Lưu token và thời gian hết hạn vào localStorage\n        localStorage.setItem(\"auth_token\", jwtToken);\n        localStorage.setItem(\"user\", JSON.stringify(user));\n        localStorage.setItem(\"token_expiration\", expirationTime);\n\n        // Điều hướng tới dashboard sau khi đăng nhập thành công\n        history.push(\"/app/dashboards/default\");\n        window.location.reload();\n        AntdMessage.success(\"Đăng nhập thành công\");\n      } else {\n        // Hiển thị thông báo nếu không nhận được JWT\n        throw new Error(\"Đăng nhập thất bại\");\n      }\n    } catch (error) {\n      console.error(\"Đăng nhập thất bại\", error);\n      AntdMessage.error(\"Đăng nhập thất bại\");\n    } finally {\n      setLoading(false); // Tắt trạng thái loading dù thành công hay thất bại\n    }\n  };\n  const onForgetPasswordClick = () => {\n    setShowForgetPassword(!showForgetPassword); // Toggle trạng thái quên mật khẩu\n  };\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Form, {\n    layout: \"vertical\",\n    name: \"login-form\",\n    onFinish: onLogin,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 67,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Form.Item, {\n    name: \"username\",\n    label: \"T\\xEAn \\u0111\\u0103ng nh\\u1EADp\",\n    rules: [{\n      required: true,\n      message: \"Vui lòng nhập tên đăng nhập\"\n    }],\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 68,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Input, {\n    prefix: /*#__PURE__*/React.createElement(UserOutlined, {\n      className: \"text-primary\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 73,\n        columnNumber: 26\n      }\n    }),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 73,\n      columnNumber: 11\n    }\n  })), /*#__PURE__*/React.createElement(Form.Item, {\n    name: \"password\",\n    label: /*#__PURE__*/React.createElement(\"div\", {\n      className: `${showForgetPassword ? \"d-flex justify-content-between w-100 align-items-center\" : \"\"}`,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 78,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"span\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 84,\n        columnNumber: 15\n      }\n    }, \"M\\u1EADt kh\\u1EA9u\"), showForgetPassword && /*#__PURE__*/React.createElement(\"span\", {\n      onClick: onForgetPasswordClick,\n      className: \"cursor-pointer font-size-sm font-weight-normal text-muted\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 86,\n        columnNumber: 17\n      }\n    }, \"Qu\\xEAn m\\u1EADt kh\\u1EA9u?\")),\n    rules: [{\n      required: true,\n      message: \"Vui lòng nhập mật khẩu\"\n    }],\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 75,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Input.Password, {\n    prefix: /*#__PURE__*/React.createElement(LockOutlined, {\n      className: \"text-primary\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 97,\n        columnNumber: 35\n      }\n    }),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 11\n    }\n  })), /*#__PURE__*/React.createElement(Form.Item, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    type: \"primary\",\n    htmlType: \"submit\",\n    block: true,\n    loading: loading,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 11\n    }\n  }, \"\\u0110\\u0103ng nh\\u1EADp\"))));\n};\nexport default LoginForm;","map":{"version":3,"names":["React","useState","Button","Form","Input","message","AntdMessage","UserOutlined","LockOutlined","useHistory","login","loginApi","jwtDecode","LoginForm","history","loading","setLoading","showForgetPassword","setShowForgetPassword","onLogin","values","response","username","password","payload","jwtToken","user","decodedToken","expirationTime","exp","role","warning","isDelete","active","localStorage","setItem","JSON","stringify","push","window","location","reload","success","Error","error","console","onForgetPasswordClick","createElement","Fragment","layout","name","onFinish","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","Item","label","rules","required","prefix","className","onClick","Password","type","htmlType","block"],"sources":["D:/job/ComputerShopNode-Plus/ComputerShopAdmin/src/views/auth-views/components/LoginForm.js"],"sourcesContent":["import React, { useState } from \"react\";\r\nimport { Button, Form, Input, message as AntdMessage } from \"antd\";\r\nimport { UserOutlined, LockOutlined } from \"@ant-design/icons\";\r\nimport { useHistory } from \"react-router-dom\";\r\nimport { login as loginApi } from \"services/authService\"; // Import API login từ authService\r\nimport { jwtDecode } from \"jwt-decode\"; // Import jwt-decode\r\n\r\nconst LoginForm = () => {\r\n  let history = useHistory();\r\n\r\n  // State management\r\n  const [loading, setLoading] = useState(false); // Quản lý trạng thái loading\r\n  const [showForgetPassword, setShowForgetPassword] = useState(false); // Quản lý trạng thái hiển thị quên mật khẩu\r\n\r\n  const onLogin = async (values) => {\r\n    setLoading(true); // Hiển thị trạng thái loading\r\n\r\n    try {\r\n      // Gọi API đăng nhập từ authService với username và password\r\n      const response = await loginApi(values.username, values.password);\r\n\r\n      // Kiểm tra nếu đăng nhập thành công\r\n      if (response && response.payload) {\r\n        const { jwtToken } = response.payload[0]; // Lấy jwtToken từ payload\r\n        const user = response.payload[1]; // Thông tin người dùng\r\n\r\n        // Giải mã JWT để lấy thời gian hết hạn\r\n        const decodedToken = jwtDecode(jwtToken);\r\n        const expirationTime = decodedToken.exp * 1000; // Thời gian hết hạn trong milliseconds\r\n        if (user.role === \"CUSTOMER\") {\r\n          AntdMessage.warning(\"Bạn không có quyền truy cập\");\r\n          return;\r\n        } else if (user.isDelete) {\r\n          AntdMessage.warning(\"Tài khoản của bạn đã bị khóa \");\r\n          return;\r\n        } else if (!user.active) {\r\n          AntdMessage.warning(\"Tài khoản của bạn chưa được kích hoạt \");\r\n          return;\r\n        }\r\n        // Lưu token và thời gian hết hạn vào localStorage\r\n        localStorage.setItem(\"auth_token\", jwtToken);\r\n        localStorage.setItem(\"user\", JSON.stringify(user));\r\n        localStorage.setItem(\"token_expiration\", expirationTime);\r\n\r\n        // Điều hướng tới dashboard sau khi đăng nhập thành công\r\n        history.push(\"/app/dashboards/default\");\r\n        window.location.reload();\r\n        AntdMessage.success(\"Đăng nhập thành công\");\r\n      } else {\r\n        // Hiển thị thông báo nếu không nhận được JWT\r\n        throw new Error(\"Đăng nhập thất bại\");\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Đăng nhập thất bại\", error);\r\n      AntdMessage.error(\"Đăng nhập thất bại\");\r\n    } finally {\r\n      setLoading(false); // Tắt trạng thái loading dù thành công hay thất bại\r\n    }\r\n  };\r\n\r\n  const onForgetPasswordClick = () => {\r\n    setShowForgetPassword(!showForgetPassword); // Toggle trạng thái quên mật khẩu\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <Form layout=\"vertical\" name=\"login-form\" onFinish={onLogin}>\r\n        <Form.Item\r\n          name=\"username\"\r\n          label=\"Tên đăng nhập\"\r\n          rules={[{ required: true, message: \"Vui lòng nhập tên đăng nhập\" }]}\r\n        >\r\n          <Input prefix={<UserOutlined className=\"text-primary\" />} />\r\n        </Form.Item>\r\n        <Form.Item\r\n          name=\"password\"\r\n          label={\r\n            <div\r\n              className={`${showForgetPassword\r\n                ? \"d-flex justify-content-between w-100 align-items-center\"\r\n                : \"\"\r\n                }`}\r\n            >\r\n              <span>Mật khẩu</span>\r\n              {showForgetPassword && (\r\n                <span\r\n                  onClick={onForgetPasswordClick}\r\n                  className=\"cursor-pointer font-size-sm font-weight-normal text-muted\"\r\n                >\r\n                  Quên mật khẩu?\r\n                </span>\r\n              )}\r\n            </div>\r\n          }\r\n          rules={[{ required: true, message: \"Vui lòng nhập mật khẩu\" }]}\r\n        >\r\n          <Input.Password prefix={<LockOutlined className=\"text-primary\" />} />\r\n        </Form.Item>\r\n        <Form.Item>\r\n          <Button type=\"primary\" htmlType=\"submit\" block loading={loading}>\r\n            Đăng nhập\r\n          </Button>\r\n        </Form.Item>\r\n      </Form>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default LoginForm;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}